"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("./util");
class MappedPipeReducer {
    constructor(opts = {}) {
        this.reducerMap = new Map();
        /**
         * Append reducer functions for the given key
         */
        this.unshift = (actionTypeOrActionTypes, reducerOrReducers) => {
            const actionTypes = util_1.getActionTypes(actionTypeOrActionTypes);
            const reducers = Array.isArray(reducerOrReducers)
                ? reducerOrReducers
                : [reducerOrReducers];
            actionTypes.forEach((actionType) => {
                const reducerArray = this.reducerMap.has(actionType)
                    ? this.reducerMap.get(actionType)
                    : [];
                reducerArray.unshift(...reducers);
                this.reducerMap.set(actionType, reducerArray);
            });
            return this;
        };
        this.prepend = this.unshift;
        /**
         * Append reducer functions for the given key
         */
        this.push = (actionTypeOrActionTypes, reducerOrReducers) => {
            const actionTypes = util_1.getActionTypes(actionTypeOrActionTypes);
            const reducers = Array.isArray(reducerOrReducers)
                ? reducerOrReducers
                : [reducerOrReducers];
            actionTypes.forEach((actionType) => {
                const reducerArray = this.reducerMap.has(actionType)
                    ? this.reducerMap.get(actionType)
                    : [];
                reducerArray.push(...reducers);
                this.reducerMap.set(actionType, reducerArray);
            });
            return this;
        };
        this.append = this.push;
        /**
         * Replace reducer functions for the given key
         */
        this.set = (actionTypeOrActionTypes, reducerOrReducers) => {
            const actionTypes = util_1.getActionTypes(actionTypeOrActionTypes);
            const reducers = Array.isArray(reducerOrReducers)
                ? reducerOrReducers
                : [reducerOrReducers];
            actionTypes.forEach((actionType) => {
                this.reducerMap.set(actionType, reducers);
            });
            return this;
        };
        /**
         * Replace reducer functions for the given key
         */
        this.delete = (actionTypeOrActionTypes) => {
            const actionTypes = util_1.getActionTypes(actionTypeOrActionTypes);
            actionTypes.forEach((actionType) => {
                this.reducerMap.delete(actionType);
            });
            return this;
        };
        this.get = (actionType) => this.reducerMap.get(actionType);
        this.reduce = (state = this.initialState, action) => {
            if (!this.reducerMap.has(action.type))
                return state;
            const reducers = this.reducerMap.get(action.type);
            return reducers.reduce((aState, reducer) => reducer(aState, action), state);
        };
        this.initialState = opts.initialState;
    }
}
exports.MappedPipeReducer = MappedPipeReducer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFwcGVkUGlwZVJlZHVjZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbGliL01hcHBlZFBpcGVSZWR1Y2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBS0EsaUNBQXVDO0FBSXZDO0lBS0UsWUFBWSxPQUFvQyxFQUFFO1FBRjFDLGVBQVUsR0FBRyxJQUFJLEdBQUcsRUFBNEMsQ0FBQTtRQU14RTs7V0FFRztRQUNJLFlBQU8sR0FBRyxDQUNmLHVCQUE4SSxFQUM5SSxpQkFBcUY7WUFFckYsTUFBTSxXQUFXLEdBQXlCLHFCQUFjLENBQUMsdUJBQXVCLENBQUMsQ0FBQTtZQUNqRixNQUFNLFFBQVEsR0FBdUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQztrQkFDakYsaUJBQWlCO2tCQUNqQixDQUFDLGlCQUFpQixDQUFDLENBQUE7WUFFdkIsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVU7Z0JBQzdCLE1BQU0sWUFBWSxHQUF1QyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUM7c0JBQ3BGLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQztzQkFDL0IsRUFBRSxDQUFBO2dCQUNOLFlBQVksQ0FBQyxPQUFPLENBQUMsR0FBRyxRQUFRLENBQUMsQ0FBQTtnQkFDakMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFBO1lBQy9DLENBQUMsQ0FBQyxDQUFBO1lBQ0YsTUFBTSxDQUFDLElBQUksQ0FBQTtRQUNiLENBQUMsQ0FBQTtRQUNNLFlBQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFBO1FBRTdCOztXQUVHO1FBQ0ksU0FBSSxHQUFHLENBQ1osdUJBQThJLEVBQzlJLGlCQUFxRjtZQUVyRixNQUFNLFdBQVcsR0FBeUIscUJBQWMsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFBO1lBQ2pGLE1BQU0sUUFBUSxHQUF1QyxL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