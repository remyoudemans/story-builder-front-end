const BatchActionType = '@@typed-redux/batched-actions';
const batchable = (reducer) => {
    return (state, action) => {
        if (action.type === BatchActionType) {
            return action.actions.reduce(reducer, state);
        }
        return reducer(state, action);
    };
};
export const batchEnhancer = (sagaMiddleware) => (createStore) => (reducer, preloadedState) => {
    const store = createStore(batchable(reducer), preloadedState);
    let sagaDispatcher = () => {
        return;
    };
    const batchDispatcher = (actionOrActions) => {
        let action;
        if (Array.isArray(actionOrActions)) {
            actionOrActions.forEach(sagaDispatcher);
            action = {
                type: BatchActionType,
                actions: actionOrActions,
            };
        }
        else {
            action = actionOrActions;
            sagaDispatcher(action);
        }
        return store.dispatch(action);
    };
    if (sagaMiddleware) {
        sagaDispatcher = sagaMiddleware({
            getState: store.getState,
            // This dispatcher will be used by `put` effect of saga
            dispatch: batchDispatcher,
        })((a) => a);
    }
    // Replace dispatch with our one
    return Object.assign({}, store, { dispatch: batchDispatcher });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmF0Y2hFbmhhbmNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYmF0Y2hFbmhhbmNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFpQkEsTUFBTSxlQUFlLEdBQUcsK0JBQStCLENBQUE7QUFPdkQsTUFBTSxTQUFTLEdBQUcsQ0FBNEIsT0FBaUQ7SUFDN0YsTUFBTSxDQUFDLENBQUMsS0FBUSxFQUFFLE1BQXVCO1FBQ3ZDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssZUFBZSxDQUFDLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUUsTUFBc0IsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQTtRQUMvRCxDQUFDO1FBQ0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFDL0IsQ0FBQyxDQUFBO0FBQ0gsQ0FBQyxDQUFBO0FBRUQsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFHLENBQUMsY0FBOEMsS0FBaUMsQ0FBSSxXQUErQyxLQUF5QyxDQUFDLE9BQU8sRUFBRSxjQUFjO0lBQy9OLE1BQU0sS0FBSyxHQUFHLFdBQVcsQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEVBQUUsY0FBYyxDQUFDLENBQUE7SUFFN0QsSUFBSSxjQUFjLEdBQXNCO1FBQ3RDLE1BQU0sQ0FBQTtJQUNSLENBQUMsQ0FBQTtJQUVELE1BQU0sZUFBZSxHQUF3QixDQUF5QixlQUF3QjtRQUM1RixJQUFJLE1BQW9CLENBQUE7UUFDeEIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQTtZQUN2QyxNQUFNLEdBQUc7Z0JBQ1AsSUFBSSxFQUFFLGVBQWU7Z0JBQ3JCLE9BQU8sRUFBRSxlQUFlO2FBQ1YsQ0FBQTtRQUNsQixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixNQUFNLEdBQUcsZUFBK0IsQ0FBQTtZQUN4QyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDeEIsQ0FBQztRQUNELE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQy9CLENBQUMsQ0FBQTtJQUVELEVBQUUsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7UUFDbkIsY0FBYyxHQUFHLGNBQWMsQ0FBQztZQUM5QixRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7WUFDeEIsdURBQXVEO1lBQ3ZELFFBQVEsRUFBRSxlQUFlO1NBQzFCLENBQUMsQ0FBQyxDQUFDLENBQWUsS0FBSyxDQUFDLENBQUMsQ0FBQTtJQUM1QixDQUFDO0lBRUQsZ0NBQWdDO0lBQ2hDLE1BQU0sbUJBQ0QsS0FBSyxJQUNSLFFBQVEsRUFBRSxlQUFlLElBQzFCO0FBQ0gsQ0FBQyxDQUFBIn0=