"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const BatchActionType = '@@typed-redux/batched-actions';
const batchable = (reducer) => {
    return (state, action) => {
        if (action.type === BatchActionType) {
            return action.actions.reduce(reducer, state);
        }
        return reducer(state, action);
    };
};
exports.batchEnhancer = (sagaMiddleware) => (createStore) => (reducer, preloadedState) => {
    const store = createStore(batchable(reducer), preloadedState);
    let sagaDispatcher = () => {
        return;
    };
    const batchDispatcher = (actionOrActions) => {
        let action;
        if (Array.isArray(actionOrActions)) {
            actionOrActions.forEach(sagaDispatcher);
            action = {
                type: BatchActionType,
                actions: actionOrActions,
            };
        }
        else {
            action = actionOrActions;
            sagaDispatcher(action);
        }
        return store.dispatch(action);
    };
    if (sagaMiddleware) {
        sagaDispatcher = sagaMiddleware({
            getState: store.getState,
            // This dispatcher will be used by `put` effect of saga
            dispatch: batchDispatcher,
        })((a) => a);
    }
    // Replace dispatch with our one
    return Object.assign({}, store, { dispatch: batchDispatcher });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmF0Y2hFbmhhbmNlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvYmF0Y2hFbmhhbmNlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQWlCQSxNQUFNLGVBQWUsR0FBRywrQkFBK0IsQ0FBQTtBQU92RCxNQUFNLFNBQVMsR0FBRyxDQUE0QixPQUFpRDtJQUM3RixNQUFNLENBQUMsQ0FBQyxLQUFRLEVBQUUsTUFBdUI7UUFDdkMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxlQUFlLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBRSxNQUFzQixDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFBO1FBQy9ELENBQUM7UUFDRCxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQTtJQUMvQixDQUFDLENBQUE7QUFDSCxDQUFDLENBQUE7QUFFWSxRQUFBLGFBQWEsR0FBRyxDQUFDLGNBQThDLEtBQWlDLENBQUksV0FBK0MsS0FBeUMsQ0FBQyxPQUFPLEVBQUUsY0FBYztJQUMvTixNQUFNLEtBQUssR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxFQUFFLGNBQWMsQ0FBQyxDQUFBO0lBRTdELElBQUksY0FBYyxHQUFzQjtRQUN0QyxNQUFNLENBQUE7SUFDUixDQUFDLENBQUE7SUFFRCxNQUFNLGVBQWUsR0FBd0IsQ0FBeUIsZUFBd0I7UUFDNUYsSUFBSSxNQUFvQixDQUFBO1FBQ3hCLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25DLGVBQWUsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUE7WUFDdkMsTUFBTSxHQUFHO2dCQUNQLElBQUksRUFBRSxlQUFlO2dCQUNyQixPQUFPLEVBQUUsZUFBZTthQUNWLENBQUE7UUFDbEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sTUFBTSxHQUFHLGVBQStCLENBQUE7WUFDeEMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBQ3hCLENBQUM7UUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQTtJQUMvQixDQUFDLENBQUE7SUFFRCxFQUFFLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDO1FBQ25CLGNBQWMsR0FBRyxjQUFjLENBQUM7WUFDOUIsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO1lBQ3hCLHVEQUF1RDtZQUN2RCxRQUFRLEVBQUUsZUFBZTtTQUMxQixDQUFDLENBQUMsQ0FBQyxDQUFlLEtBQUssQ0FBQyxDQUFDLENBQUE7SUFDNUIsQ0FBQztJQUVELGdDQUFnQztJQUNoQyxNQUFNLG1CQUNELEtBQUssSUFDUixRQUFRLEVBQUUsZUFBZSxJQUMxQjtBQUNILENBQUMsQ0FBQSJ9